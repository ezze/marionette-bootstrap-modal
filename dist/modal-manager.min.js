!function(a,b){"function"==typeof define&&define.amd?define([],b):a.ModalManager=b()}(this,function(){var a,b,c;!function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("almond",["i18next"],function(){}),c("jquery",{}),c("i18next",{}),c("lodash",{}),c("backbone",{}),c("modal",["backbone","lodash"],function(a,b){"use strict";var c=a.Model.extend({defaults:{title:"",titleI18n:"",view:null,closeButton:!0,closeButtonCaption:"Close",closeButtonCaptionI18n:"modal.close",buttons:[]},initialize:function(){b.each(this.get("buttons"),function(a,c){b.isString(a.id)||(a.id="button-"+(c+1))})}});return c}),c("bootstrap",{}),c("marionette",{});var d={};return function(a,b){function c(a,b,c){var d;return b&&"object"==typeof b&&(null!=b[a]?d=b[a]:c&&b.get&&"function"==typeof b.get&&(d=b.get(a))),d}function d(a,b,c,d){function e(){}function f(){}e.prototype=a,f.prototype=a.subs;var g,h=new e;h.subs=new f,h.subsText={},h.ib();for(g in b)h.subs[g]=b[g],h.subsText[g]=d;for(g in c)h.partials[g]=c[g];return h}function e(a){return String(null===a||void 0===a?"":a)}function f(a){return a=e(a),l.test(a)?a.replace(g,"&amp;").replace(h,"&lt;").replace(i,"&gt;").replace(j,"&#39;").replace(k,"&quot;"):a}a.Template=function(a,b,c,d){a=a||{},this.r=a.code||this.r,this.c=c,this.options=d||{},this.text=b||"",this.partials=a.partials||{},this.subs=a.subs||{},this.ib()},a.Template.prototype={r:function(a,b,c){return""},v:f,t:e,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},ep:function(a,b){var c=this.partials[a],e=b[c.name];if(c.instance&&c.base==e)return c.instance;if("string"==typeof e){if(!this.c)throw new Error("No compiler available.");e=this.c.compile(e,this.options)}return e?(this.partials[a].base=e,c.subs&&(void 0===this.activeSub&&(b.stackText=this.text),e=d(e,c.subs,c.partials,b.stackText||this.text)),this.partials[a].instance=e,e):null},rp:function(a,b,c,d){var e=this.ep(a,c);return e?e.ri(b,c,d):""},rs:function(a,b,c){var d=a[a.length-1];if(!m(d))return void c(a,b,this);for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return m(a)&&0===a.length?!1:("function"==typeof a&&(a=this.ms(a,b,c,d,e,f,g)),h=!!a,!d&&h&&b&&b.push("object"==typeof a?a:b[b.length-1]),h)},d:function(a,b,d,e){var f,g=a.split("."),h=this.f(g[0],b,d,e),i=this.options.modelGet,j=null;if("."===a&&m(b[b.length-2]))h=b[b.length-1];else for(var k=1;k<g.length;k++)f=c(g[k],h,i),null!=f?(j=h,h=f):h="";return e&&!h?!1:(e||"function"!=typeof h||(b.push(j),h=this.mv(h,b,d),b.pop()),h)},f:function(a,b,d,e){for(var f=!1,g=null,h=!1,i=this.options.modelGet,j=b.length-1;j>=0;j--)if(g=b[j],f=c(a,g,i),null!=f){h=!0;break}return h?(e||"function"!=typeof f||(f=this.mv(f,b,d)),f):e?!1:""},ls:function(a,b,c,d,f){var g=this.options.delimiters;return this.options.delimiters=f,this.b(this.ct(e(a.call(b,d)),b,c)),this.options.delimiters=g,!1},ct:function(a,b,c){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(a,this.options).render(b,c)},b:b?function(a){this.buf.push(a)}:function(a){this.buf+=a},fl:b?function(){var a=this.buf.join("");return this.buf=[],a}:function(){var a=this.buf;return this.buf="",a},ib:function(){this.buf=b?[]:""},ms:function(a,b,c,d,e,f,g){var h,i=b[b.length-1],j=a.call(i);return"function"==typeof j?d?!0:(h=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(j,i,c,h.substring(e,f),g)):j},mv:function(a,b,c){var d=b[b.length-1],f=a.call(d);return"function"==typeof f?this.ct(e(f.call(d)),d,c):f},sub:function(a,b,c,d){var e=this.subs[a];e&&(this.activeSub=a,e(b,c,this,d),this.activeSub=!1)}};var g=/&/g,h=/</g,i=/>/g,j=/\'/g,k=/\"/g,l=/[&<>\"\']/,m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}}("undefined"!=typeof exports?exports:d),function(a){function b(a){"}"===a.n.substr(a.n.length-1)&&(a.n=a.n.substring(0,a.n.length-1))}function c(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function d(a,b,c){if(b.charAt(c)!=a.charAt(0))return!1;for(var d=1,e=a.length;e>d;d++)if(b.charAt(c+d)!=a.charAt(d))return!1;return!0}function e(b,c,d,h){var i=[],j=null,k=null,l=null;for(k=d[d.length-1];b.length>0;){if(l=b.shift(),k&&"<"==k.tag&&!(l.tag in t))throw new Error("Illegal content in < super tag.");if(a.tags[l.tag]<=a.tags.$||f(l,h))d.push(l),l.nodes=e(b,l.tag,d,h);else{if("/"==l.tag){if(0===d.length)throw new Error("Closing tag without opener: /"+l.n);if(j=d.pop(),l.n!=j.n&&!g(l.n,j.n,h))throw new Error("Nesting error: "+j.n+" vs. "+l.n);return j.end=l.i,i}"\n"==l.tag&&(l.last=0==b.length||"\n"==b[0].tag)}i.push(l)}if(d.length>0)throw new Error("missing closing tag: "+d.pop().n);return i}function f(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c].o==a.n)return a.tag="#",!0}function g(a,b,c){for(var d=0,e=c.length;e>d;d++)if(c[d].c==a&&c[d].o==b)return!0}function h(a){var b=[];for(var c in a)b.push('"'+j(c)+'": function(c,p,t,i) {'+a[c]+"}");return"{ "+b.join(",")+" }"}function i(a){var b=[];for(var c in a.partials)b.push('"'+j(c)+'":{name:"'+j(a.partials[c].name)+'", '+i(a.partials[c])+"}");return"partials: {"+b.join(",")+"}, subs: "+h(a.subs)}function j(a){return a.replace(s,"\\\\").replace(p,'\\"').replace(q,"\\n").replace(r,"\\r")}function k(a){return~a.indexOf(".")?"d":"f"}function l(a,b){var c="<"+(b.prefix||""),d=c+a.n+u++;return b.partials[d]={name:a.n,partials:{}},b.code+='t.b(t.rp("'+j(d)+'",c,p,"'+(a.indent||"")+'"));',d}function m(a,b){b.code+="t.b(t.t(t."+k(a.n)+'("'+j(a.n)+'",c,p,0)));'}function n(a){return"t.b("+a+");"}var o=/\S/,p=/\"/g,q=/\n/g,r=/\r/g,s=/\\/g;a.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},a.scan=function(e,f){function g(){s.length>0&&(t.push({tag:"_t",text:new String(s)}),s="")}function h(){for(var b=!0,c=w;c<t.length;c++)if(b=a.tags[t[c].tag]<a.tags._v||"_t"==t[c].tag&&null===t[c].text.match(o),!b)return!1;return b}function i(a,b){if(g(),a&&h())for(var c,d=w;d<t.length;d++)t[d].text&&((c=t[d+1])&&">"==c.tag&&(c.indent=t[d].text.toString()),t.splice(d,1));else b||t.push({tag:"\n"});u=!1,w=t.length}function j(a,b){var d="="+y,e=a.indexOf(d,b),f=c(a.substring(a.indexOf("=",b)+1,e)).split(" ");return x=f[0],y=f[f.length-1],e+d.length-1}var k=e.length,l=0,m=1,n=2,p=l,q=null,r=null,s="",t=[],u=!1,v=0,w=0,x="{{",y="}}";for(f&&(f=f.split(" "),x=f[0],y=f[1]),v=0;k>v;v++)p==l?d(x,e,v)?(--v,g(),p=m):"\n"==e.charAt(v)?i(u):s+=e.charAt(v):p==m?(v+=x.length-1,r=a.tags[e.charAt(v+1)],q=r?e.charAt(v+1):"_v","="==q?(v=j(e,v),p=l):(r&&v++,p=n),u=v):d(y,e,v)?(t.push({tag:q,n:c(s),otag:x,ctag:y,i:"/"==q?u-x.length:v+y.length}),s="",v+=y.length-1,p=l,"{"==q&&("}}"==y?v++:b(t[t.length-1]))):s+=e.charAt(v);return i(u,!0),t};var t={_t:!0,"\n":!0,$:!0,"/":!0};a.stringify=function(b,c,d){return"{code: function (c,p,i) { "+a.wrapMain(b.code)+" },"+i(b)+"}"};var u=0;a.generate=function(b,c,d){u=0;var e={code:"",subs:{},partials:{}};return a.walk(b,e),d.asString?this.stringify(e,c,d):this.makeTemplate(e,c,d)},a.wrapMain=function(a){return'var t=this;t.b(i=i||"");'+a+"return t.fl();"},a.template=a.Template,a.makeTemplate=function(a,b,c){var d=this.makePartials(a);return d.code=new Function("c","p","i",this.wrapMain(a.code)),new this.template(d,b,this,c)},a.makePartials=function(a){var b,c={subs:{},partials:a.partials,name:a.name};for(b in c.partials)c.partials[b]=this.makePartials(c.partials[b]);for(b in a.subs)c.subs[b]=new Function("c","p","t","i",a.subs[b]);return c},a.codegen={"#":function(b,c){c.code+="if(t.s(t."+k(b.n)+'("'+j(b.n)+'",c,p,1),c,p,0,'+b.i+","+b.end+',"'+b.otag+" "+b.ctag+'")){t.rs(c,p,function(c,p,t){',a.walk(b.nodes,c),c.code+="});c.pop();}"},"^":function(b,c){c.code+="if(!t.s(t."+k(b.n)+'("'+j(b.n)+'",c,p,1),c,p,1,0,0,"")){',a.walk(b.nodes,c),c.code+="};"},">":l,"<":function(b,c){var d={partials:{},code:"",subs:{},inPartial:!0};a.walk(b.nodes,d);var e=c.partials[l(b,c)];e.subs=d.subs,e.partials=d.partials},$:function(b,c){var d={subs:{},code:"",partials:c.partials,prefix:b.n};a.walk(b.nodes,d),c.subs[b.n]=d.code,c.inPartial||(c.code+='t.sub("'+j(b.n)+'",c,p,i);')},"\n":function(a,b){b.code+=n('"\\n"'+(a.last?"":" + i"))},_v:function(a,b){b.code+="t.b(t.v(t."+k(a.n)+'("'+j(a.n)+'",c,p,0)));'},_t:function(a,b){b.code+=n('"'+j(a.text)+'"')},"{":m,"&":m},a.walk=function(b,c){for(var d,e=0,f=b.length;f>e;e++)d=a.codegen[b[e].tag],d&&d(b[e],c);return c},a.parse=function(a,b,c){return c=c||{},e(a,"",[],c.sectionTags||[])},a.cache={},a.cacheKey=function(a,b){return[a,!!b.asString,!!b.disableLambda,b.delimiters,!!b.modelGet].join("||")},a.compile=function(b,c){c=c||{};var d=a.cacheKey(b,c),e=this.cache[d];return e?e:(e=this.generate(this.parse(this.scan(b,c.delimiters),b,c),b,c),this.cache[d]=e)}}("undefined"!=typeof exports?exports:d),"function"==typeof c&&c.amd&&c("hogan",d),c("templates/modal",["hogan"],function(a){var b={modal:new a.Template({code:function(a,b,c){var d=this;return d.b(c=c||""),d.b('<div class="modal-dialog">'),d.b("\n"+c),d.b('    <div class="modal-content">'),d.b("\n"+c),d.b('        <div class="modal-header">'),d.b("\n"+c),d.s(d.f("closeButton",a,b,1),a,b,0,122,276,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'),d.b("\n"+c)}),a.pop()),d.b('            <h4 class="modal-title" data-i18n="'),d.b(d.v(d.f("titleI18n",a,b,0))),d.b('">'),d.b(d.v(d.f("title",a,b,0))),d.b("</h4>"),d.b("\n"+c),d.b("        </div>"),d.b("\n"+c),d.b('        <div class="modal-body"></div>'),d.b("\n"+c),d.b('        <div class="modal-footer">'),d.b("\n"+c),d.s(d.f("buttons",a,b,1),a,b,0,483,686,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('                <button type="button" class="modal-button btn btn-'),d.s(d.f("style",a,b,1),a,b,0,560,569,"{{ }}")&&(d.rs(a,b,function(a,b,c){c.b(c.v(c.f("style",a,b,0)))}),a.pop()),d.s(d.f("style",a,b,1),a,b,1,0,0,"")||d.b("default"),d.b('" data-id="'),d.b(d.v(d.f("id",a,b,0))),d.b('" data-i18n="'),d.b(d.v(d.f("captionI18n",a,b,0))),d.b('">'),d.b(d.v(d.f("caption",a,b,0))),d.b("</button>"),d.b("\n"+c)}),a.pop()),d.s(d.f("closeButton",a,b,1),a,b,0,727,890,"{{ }}")&&(d.rs(a,b,function(a,b,d){d.b('            <button type="button" class="btn btn-default" data-dismiss="modal" data-i18n="'),d.b(d.v(d.f("closeButtonCaptionI18n",a,b,0))),d.b('">'),d.b(d.v(d.f("closeButtonCaption",a,b,0))),d.b("</button>"),d.b("\n"+c)}),a.pop()),d.b("        </div>"),d.b("\n"+c),d.b("    </div>"),d.b("\n"+c),d.b("</div>"),d.fl()},partials:{},subs:{}})},c=function(a){var c=b[a];return function(a,d,e){return c.render(a,d||b,e)}};return{modal:c("modal")}}),c("views/modal-view",["bootstrap","jquery","lodash","marionette","../templates/modal"],function(a,b,c,d,e){"use strict";var f=d.LayoutView.extend({className:"modal fade",template:e.modal,ui:{button:".modal-button"},events:{"click @ui.button":"onButtonClick"},regions:{body:".modal-body"},initialize:function(a){this._hideDeferred=null;var b=a.i18nEventObject,d=a.i18nEventName;this._i18nEventObject=b&&c.isFunction(b.trigger)?b:null,this._i18nEventName=c.isString(d)?d:"language",this._i18nEventObject&&this.listenTo(this._i18nEventObject,this._i18nEventName,this.translate)},translate:function(){this.$el.i18n()},show:function(){var a=this,c=new b.Deferred,d=this._hideDeferred=new b.Deferred,e=this.model.get("closeButton");return this.$el.modal({backdrop:e?!0:"static",keyboard:!1,show:!0}).one("shown.bs.modal",function(){c.resolve(a)}).one("hidden.bs.modal",function(){d.resolve(a)}),c},hide:function(){return null===this._hideDeferred?null:(this.$el.modal("hide"),this._hideDeferred)},onRender:function(){this._i18nEventObject&&this.translate();var a=this.model.get("view");a&&this.getRegion("body").show(a)},onButtonClick:function(a){a.preventDefault();var d=b(a.currentTarget),e=d.attr("data-id"),f=c.find(this.model.get("buttons"),function(a){return a.id===e});f&&c.isFunction(f.handler)&&f.handler.apply(this,[this.getRegion("body").currentView,e])}});return f}),c("modal-manager",["backbone","lodash","jquery","./modal","./views/modal-view"],function(a,b,c,d,e){"use strict";var f=function(a){this.$container=c(a.container),this._modalView=null;var d=a.i18nEventObject,e=a.i18nEventName;this._i18nEventObject=d&&b.isFunction(d.trigger)?d:null,this._i18nEventName=b.isString(e)?e:"language"};return b.extend(f.prototype,{show:function(a){var b=a instanceof d?a:new d(a);if(null!==this._modalView){if(!b)return this._modalView.show();var f,g=this,h=new c.Deferred,i=this.hide();return i.done(function(){f=g.show(b),f.done(function(a){h.resolve(a)})}),h}return this._modalView=new e({model:b,i18nEventObject:this._i18nEventObject,i18nEventName:this._i18nEventName}),this._modalView.render(),this.$container.append(this._modalView.$el),this._modalView.show()},hide:function(){if(null===this._modalView)return(new c.Deferred).resolve();var a=this._modalView.hide();return a.done(b.bind(function(){null!==this._modalView&&(this._modalView.destroy(),this._modalView=null)},this)),a},getCurrentModalView:function(){return this._modalView},getCurrentModalBodyView:function(){if(null===this._modalView)return null;var b=this._modalView.model;if(!b)return null;var c=b.get("view");return c instanceof a.View?c:null}}),f}),b("modal-manager")});